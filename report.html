<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-GB" xml:lang="en-GB">
    <head>
    	<meta charset="UTF-8"/>
    	<meta content="application/xhtml+xml"/>
    	<meta name="viewport" content="width=device-width, user-scalable=no"/>
		<title>My Game Boo-Chee-Q</title>
		<link href="css3.css" rel="stylesheet" type="text/css" />
        <script src="js.js" type="text/javascript"></script>
		<link rel="shortcut icon" href="jets2.png" /> 
		
        <script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
        <script src="betterinnerhtml.js" type="text/javascript"></script>
		<!--[if lt IE 9]>
        	<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <!-- -->
        <script type="text/javascript">var switchTo5x=true;</script>
		<script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
		<script type="text/javascript">stLight.options({publisher: "0f2a4bad-960d-4d9a-9899-0bd15a1ec6f7", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>
    </head>
    <body class="body">
    	<header class="mainHeader">
    		<img src="logo.png" />
    		<nav>
    			<ul>
					<li><a href="index.html">Home</a></li>   
					<li class="active" ><a href="report.html">Report</a></li>  
					<li><a href="game.html">Game</a></li>  
					<li><a href="#">Contact</a></li>  	
    				
    			</ul>
    		</nav>
    	</header>
    	
    	
        <div class="reportContent">
        	<div class="reportContentuseless">
        		<article class="topcontent">
        			<header>
        				<h2><a href="#" title="First post">Project Report (Client)</a></h2>
        			</header>
        			<footer>
        				<p class="post-info">This report is written by Ping Wang</p>
        			</footer>
        			<content>
This report explains the client project which includes a XHTML5 webpage and a XHTML5 game. <br/><br/>

I haven't do CSS and Javascript developing before and game developing aslo. This is a great chance for me to learn these technologies.

In order to learn those new languages, I haven't use any third party libraries and frameworks. All logic and styles were managed by Javascript and CSS only, and all codes were 
developed by myself.<br/>

<div class="subtoc">
	<p>Contents</p>
	<ol>
		<li><a href="#h-1">XHTML5 webpage (spent 16 hours)</a></li>
		<ol>
			<li><a href="#h-1-1">XHTML5</a></li>
			<ol>
				<li><a href="#h-1-1-a">Mobile devices consideration</a></li>
				<li><a href="#h-1-1-b">Favicon</a></li>
				<li><a href="#h-1-1-c">All involved tabs</a></li>
				<li><a href="#h-1-1-d">HTML + CSS</a></li>
				<li><a href="#h-1-1-e">IE9 supported</a></li>
                <li><a href="#h-1-1-f">Handling HTML reserved characters</a></li>
			</ol>
			<li><a href="#h-1-2">CSS3</a></li>
			<ol>
				<li><a href="#h-1-2-a">CSS inheritance</a></li>
				<li><a href="#h-1-2-b">Layout and mobile devices consideration</a></li>
				<li><a href="#h-1-2-c">Multi styles for links(for different status)</a></li>
				<li><a href="#h-1-2-d">Units</a></li>
				<li><a href="#h-1-2-e">Main CSS styles</a></li>
			</ol>
			<li><a href="#h-1-3">Form</a></li>
			<ol>
				<li><a href="#h-1-3-a">HTML form</a></li>
				<li><a href="#h-1-3-b">Validation</a></li>
			</ol>
			<li><a href="#h-1-4">Video</a></li>
		</ol>
		<li><a href="#h-2">Game (spent 200 hours)</a></li>
		<ol>
			<li><a href="#h-2-1">Drawings</a></li>
			<ol>
                <li><a href="#h-2-1-a">Tutorials</a></li>
                <li><a href="#h-2-1-b">Jet</a></li>
                <li><a href="#h-2-1-c">Enemy jet</a></li>
                <li><a href="#h-2-1-d">Bullet</a></li>
                <li><a href="#h-2-1-e">Explosing</a></li>
                <li><a href="#h-2-1-f">Background</a></li>
                <li><a href="#h-2-1-g">Start Page</a></li>
                <li><a href="#h-2-1-h">Sprite</a></li>
                <li><a href="#h-2-1-i">Moving background</a></li>
            </ol>
			<li><a href="#h-2-2">XHTML5</a></li>
			<li><a href="#h-2-3">Javascript</a></li>
            <ol>
                <li><a href="#h-2-3-a">Mechanism</a></li>
                <li><a href="#h-2-3-b">Touch screen for tablet</a></li>
                <li><a href="#h-2-3-c">Social network sharing</a></li>
                <li><a href="#h-2-3-d">Javascript Trick</a></li>
                <ol>
                    <li><a href="#h-2-3-d-1">Event</a></li>
                    <li><a href="#h-2-3-d-2">Single Javascript Function</a></li>
                    <li><a href="#h-2-3-d-3">Innerhtml</a></li>
                </ol>
                <li><a href="#h-2-3-e">Object-Oriented programming</a></li>
                <li><a href="#h-2-3-f">Game level</a></li>
                <li><a href="#h-2-3-g">Jet Zpath Moving</a></li>
                <li><a href="#h-2-3-h">Moving background</a></li>
                <li><a href="#h-2-3-i">Looping</a></li>
                <li><a href="#h-2-3-j">Sprite</a></li>
                <li><a href="#h-2-3-k">Mouse event handling</a></li>
                <li><a href="#h-2-3-l">Memory Management</a></li>
                <li><a href="#h-2-3-m">Auto scale</a></li>
            </ol>
		</ol>
		<li><a href="#h-3">Development Environment</a></li>
        <li><a href="#h-4">Testing</a></li>
        <li><a href="#h-5">SAFE Error Handling</a></li>
        <li><a href="#h-6">Google Cloud</a></li>
		
		
	</ol>
</div>

<h2><a name="h-1">1,</a> XHTML5 webpage (spent 20 hours)</h2>
<h3><a name="h-1-1">1.1,</a> XHTML5</h3>
This XHTML5 section was developed by using XHTML5 + CSS3. The main technology solutions were learnt from an online <a href="http://alturl.com/e5rfw">tutorial</a>

Except XHTML5 basic functionalities, there are several features will be highlighted below:
<h4><a name="h-1-1-a">1.1.1</a> Mobile devices consideration.</h4>
Mobile devices were supported by meta tag which was learnt from <a href="https://developer.mozilla.org/en/docs/Mozilla/Mobile/Viewport_meta_tag">an online post</a>. Small screen also was considered, a mobile layout also managed by CSS, that will be illustrated in the CSS section.

<h4><a name="h-1-1-b">1.1.2</a> Favicon.</h4>
Favicon is a browser sensitive feature. The solution of this project was learnt from http://en.wikipedia.org/wiki/Favicon.
After researched online, most posts mentioned that “.icon” image is recommended format. However the ".icon" image which generated by GIMP was not recognized. So this project used png format for the favicon.
<img src="1_html_0.png" class="reportImg"/>
<h4><a name="h-1-1-c">1.1.3</a> All involved tabs:</h4>
<li>&lt;header&gt; was used for containing logo and navigation bar.</li>
<li>&lt;footer&gt; is a footer of HTML section which was used for contain "Acknowledge".</li>
<li>&lt;nav&gt; and &lt;ul&gt; were used to build the navigation bar.</li>
<li>&lt;articl&gt; was the container for managing the main content of this project.</li>
<li>&lt;aside&gt; was the container for sidebars which were displaying beside main contents.</li>
<li>&lt;pre&gt; is a container which preserves both spaces and line breaks. Therefore, it was boradly used in report section for displaying source codes.</li> 
<li>&lt;canvas&gt; was used for developing game which will be introduce in <a href="#h-2">game</a> section</li>
<li>&lt;form&gt; elements was included in this project for building a HTML form.</li> 
<li>&lt;img&gt; tags were used for displaying snapshots in report section.</li> 
<li>&lt;h1&gt;, &lt;h2&gt;, &lt;h3&gt;... and &lt;a&gt;</li>


<h4><a name="h-1-1-d">1.1.4</a> HTML + CSS</h4>
All XHTML elements displayed on this webpage were created by HTML tags but the layout was managed by CSS.
<img src="1_html_1.png" class="reportImg"/>

<h4><a name="h-1-1-e">1.1.5</a> IE9 support</h4>
For IE9's html5 supporting, a part of xml was added into XHTML file:
<pre class="code">
&lt;!--[if lt IE 9]&gt;
  &lt;script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"&gt;&lt;/script&gt;
  &lt;script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"&gt;&lt;/script&gt;
&lt;![endif]--&gt;
</pre>

<h4><a name="h-1-1-f">1.1.6</a> Handling HTML reserved characters</h4>
In this the project report, nembers of code segments were displayed. However, there were several HTML reserved characters in code segments.
To display them, <b>"&lt;"</b> and <b>"&gt;"</b> were replaced by  <b>&amp;lt;</b> <b>&amp;gt;</b>. Addtionally, to display "&amp;gt;", it was wrote as "(and sign)amp;gt".
<h3><a name="h-1-2">1.2,</a> CSS3</h3>

CSS plays the significant role in this project. It was used to add styles and control layouts. Several technology solutions will be highlighted in this report:<br />

<h4><a name="h-1-2-a">1.2.1</a> CSS inheritance </h4>
CSS inheritance is commonly recognized as sub tags inheriting styles from parent tags (more <a href="http://dorward.me.uk/www/css/inheritance/">explanations</a>). 
However, a CSS style inherits from another CSS style was expected in this project. 
For example corner radius styles were boardly used styles for all containers.
Without CSS inheritance, developers have to copy styles into other CSS sectors. But there will be a lot of copies in CSS files. 
If a setting need to be changed, that change needs 
to be implemented into all places. Therefore a CSS inheritance feature was needed.<br />

The CSS inheritance mechanism was expected work as this:
<pre class="code">
.rounded_corners {  
   -moz-border-radius: 8px;  
   -webkit-border-radius: 8px;  
   border-radius: 8px;
}
#header {  
  .rounded_corners;          /* header inherits rounded corners styles */
}
#footer {
  .rounded_corners;          /* header inherits rounded corners styles */
} 
</pre>

After research, there were three solutions: <br/>

<h5>Solution 1:</h5> Creating a base style and appling to HTML tags. However, this was not a real inheritance solution.
<pre class="code">
&lt;article class='content rounded_corners'&gt;
</pre>
<h5>Solution 2:</h5> Overriding existing styles. Nevertheless, the base styles were only able to be shared to one sub CSS sector with same name.
<pre class="code">
.topcontent {
	border-radius : 5px;
	-moz-border-radius : 5px;
	-webkit-border-radius : 5px;
}
.topcontent {
	background-color: #FFF;
}
</pre>
<h5>Solution 3:</h5> Firstly, coding CSS files and adding extendsion and inheritance. Subsequently, using preprocess application to process CSS files.
There were several preprocess applications: <a href="http://lesscss.org/"> less </a> and <a href="http://sass-lang.com/install"> sass </a>
<br/><br/>

After considering of all solutions, this project didn't adopt any of them. The final solution was making copies.

<h4><a name="h-1-2-b">1.2.2</a> Layout and mobile devices consideration</h4>
As this report mentioned above, CSS was used for controling the layout of this project. 
This project was designed for adapting different size of browsers, below diagram shows the layout design:
<img src="1_css_0.png" class="reportImg"/>
The thinner layout was designed for smaller screen devices such as mobiles.

"@media" was the CSS tag was the mainly technology which was used for adapting screen sizes. This tag offers an alternative CSS style settings if users' screen is smaller than specific size.
Base on this technology, this project was able to offer mobile styles control ability. 
<pre class="code">
@media only screen and (max-width: 480px)  and (min-width: 150px){ }
</pre>

All styles in @media will be activated when the screen smaller than 480px. All CSS were used for overriding the default styles. 
For example, below styles were used for making navigations to display vertically. It only overrided partial CSS styles, but still keep other styles, such as coner radius.
<pre class="code">
@media only screen and (max-width: 480px)  and (min-width: 150px){
	.body{
		width: 90%;
		font-size:95%;
	}
	.mainHeader img{
		width : 100%;
	}
	.mainHeader nav{
		height:160px;
	}
	.mainHeader nav ul {
		/*height:100%;*/
		padding-left:0;
	}
	.mainHeader nav ul li{
		width:100%;
		text-align:center;
	}
	.mainHeader nav a:link,.mainHeader nav a:visited{
		padding:10px 25px;
		display:block;
	}
}
</pre>
<img src="1_css_1.png" class="reportImg"/>

<h4><a name="h-1-2-c">1.2.3</a> Multi styles for links(for different status)</h4>
“a:link” for the style of a normal link, “a:visited” for a clicked link, “a:hover” for links mouse over. For example:
<pre class="code">
.mainHeader nav a:link,.mainHeader nav a:visited{
	color:#FFF;
	display: inline-block;
	padding:10px 25px;
	height: 20px;
}

.mainHeader nav a:hover, .mainHeader nav a:active,
.mainHeader nav .active a:link, .mainHeader nav .active a:visited{
	background-color:#CF5C3F;	
	text-shadow: none;
}
</pre>



<h4><a name="h-1-2-d">1.2.4</a>Units</h4>
Px is a commonly used units on web page design. Px depends on the screen's resolution, it provides good across platforms ability. But it is not recommended to use, because the text doesn't scale when the visitor changes the default text size. "em" and percentage were widely used units in this project. 1em = 100% = current font size. By default, 1em equals 16px. To avoid use px directly, “font-size : 87.5%;” was used to control the font size. If “font-size = 87.5%”, then 1em = 16px * 87.5%.

<h4><a name="h-1-2-e">1.2.5</a>Main CSS styles:</h4>

<pre class="code">
background-color: #FFF;          /*background color*/
border-radius : 5px;            /*border coner radius*/
-moz-border-radius : 5px;       /* for firefox*/
-webkit-border-radius : 5px;     /* for webkit*/
padding : 3% 5%;                /* padding top=bottom
margin-top : 2%;
</pre>
Abouve CSS were used to control styles of corner radius, margins and paddings.
To adapt to different browsers, corner radius were set by several settings for different browsers separately.<br />
Padding and margin were boardly used in this project for controling the layout. 
Padding was used to control the space from the boundary to inset contents.
Margin was use to control the space out of the boundary. 
Margin and padding both accept below settings:
<pre class="code">
margin:10px 5px 15px 20px;
    /*
        top margin is 10px
        right margin is 5px
        bottom margin is 15px
        left margin is 20px
    */

margin:10px 5px 15px;
    /*
        top margin is 10px
        right and left margins are 5px
        bottom margin is 15px
    */
margin:10px 5px;
    /*
        top and bottom margins are 10px
        right and left margins are 5px
    */
margin:10px;
    /*
        all four margins are 10px
    */
</pre>

<pre class="code">
padding-top:2em;          /*Specific top padding */
padding-left:2em;         /*Specific left padding */
padding-right:2em;        /*Specific right padding */
padding-bottom,:2em;      /*Specific bottom padding */
</pre>

Regarding Font, below are the global settings for text styles. 
<pre class="code">
 body{                         /*basic style*/
	color : #000305;      /*text colour*/
	font-size : 87.5%;    /* the base font is 14px*/ /*relative units */
	font-family: Arial,"Liberation Sans",sans-serif;   
	                     /*Arial is a Windows font, therefore i supply different fonts.*/
	line-height: 1.5;
	text-align: left;
	background-color:#CCCCCC;
 }
</pre>





<h3><a name="h-1-3">1.3,</a> Form</h3>
<h3><a name="h-1-3-a">1.3.1,</a>HTML form</h3>
This project has a HTML form. This form's layout was managed by a table. Date fields' name located in the first columns and all HTML input tags
located in the second columns.  
<img src="1_html_2.png" class="reportImg"/>

<h3><a name="h-1-3-b">1.3.2,</a>Validation</h3>
<a href="http://parsleyjs.org/">Parsleyjs</a> was adopted in this project. Parsleyjs is a very simple Javascript library,
To add this ability into a HTML web page, developers can simply add "data-parsley-validate" into "form" tags.<br/>
"required" is used for configurating a compulsion field.<br />
"type="email"" is used for setting a email field, this field will be validated as an email address.<br />
<pre class="code">
&lt;form id="demo-form" data-parsley-validate&gt;
&lt;input type="password" name="password" class="input" required/&gt;
</pre> 

<h3><a name="h-1-4">1.3,</a>Video</h3>
This project also embeded a video for demostrating video capbility.<br />
HTML5 offers video features by:
<pre class="code">
&lt;video width="320" height="240" controls&gt;
  &lt;source src="movie.mp4" type="video/mp4"&gt;
  &lt;source src="movie.ogg" type="video/ogg"&gt;
&lt;/video&gt;    
</pre>
New browsers support HTML5 video element, but old browsers such as IE8 does not support.
Alternatively, Flash player is a commonly used video solution. 
Recognizing browsers' supporting and offering Flash for playing was a panic issue for developers.
However, Youtube has already solved that. Developers can upload videos onto Youtube, and embed the vedio into their websit by:
<pre class="code">
&lt;iframe class="video" src="//www.youtube.com/embed/DhLNO3XlbJs" frameborder="0" allowfullscreen&gt;&lt;/iframe&gt;
</pre> 
Youtube will use the proper video player to play the video. Addtionaly, Youtube offers a <a href="http://www.youtube.com/html5">web page</a> to users for setting video players.
<img src="1_html_3.png" class="reportImg"/>
Once users set "Requet HTML5 player" all videos from Youtube will be played by HTML5 video player.

<h2><a name="h-2">2,</a> Game (spent 200 hours)</h2>
The basic knowledges were learnt from <a href="http://alturl.com/8dwmc"> a Youtube video</a>. 
In the following sections, this report will illustrate in which aspects the project enhanced the game after learnt from the video.
<h3><a name="h-2-1">2.1,</a> Drawings</h3>
<h4><a name="h-2-1-a">2.1.1</a> Tutorials</h4>
Learnt how to draw cartoon from a <a href="http://alturl.com/rzyp6">tutorialst</a><br/>
Learnt to use inkscape from a <a href="http://inkscape.org/doc/advanced/tutorial-advanced.html">tutorialst</a><br/>
<h4><a name="h-2-1-b">2.1.2</a> Jet</h4>
<h5>Firstly, drawing sketch by inkscape:</h5>
<img src="3_pic_1.png" class="reportImg"/>

<h5>Secondly, filling colours by GIMP</h5>
<img src="3_pic_2.png" class="reportImg"/>
<h4><a name="h-2-1-c">2.1.3</a> Enemy jet</h4>
<img src="3_pic_3.png" class="reportImg"/>
Antialias learnt from a <a href="http://docs.gimp.org/en/plug-in-antialias.html">tutorialst</a>
<h4><a name="h-2-1-d">2.1.4</a> Bullet</h4>
First, create a blank layer and draw blend colour.
Then, use "Fuzzy select tool" to select the bullet in bullet layer.
Subsequently, select blend layer in the layer view and use "ctrl + c" to copy.
Finally, paste into a new file which has transparent background. 

<img src="3_pic_4.png" class="reportImg"/>

<h4><a name="h-2-1-e">2.1.5</a> Explosing</h4>
<img src="3_pic_5.png" class="reportImg"/>
<h4><a name="h-2-1-f">2.1.6</a> Background</h4>
Regarding drawing background, the drawing was learnt from a <a href="http://www.how-to-draw-cartoons-online.com/cartoon-desert.html">tutorials</a>.<br />
<br />
One thing worth to mention was deleting segment of lines in Inkscape was difficult. It was solved by drawing "brush strokes" and “cut path” 
<img src="3_pic_6.png" class="reportImg"/>

Colours were filled by GIMP. Sunshine was created by "smudge tool". Airbrush was used to create shadow and "pencil tool" was used to change the drawing in detail. 
<img src="3_pic_7.png" class="reportImg"/>
<h4><a name="h-2-1-g">2.1.7</a> Start Page</h4>
<img src="3_pic_8.png" class="reportImg"/>
<img src="3_pic_9.png" class="reportImg"/>
<img src="3_pic_10.png" class="reportImg"/>
<h4><a name="h-2-1-h">2.1.8</a> Sprite</h4>
<img src="3_pic_11.png" class="reportImg"/>
<h4><a name="h-2-1-i">2.1.9</a> Moving background</h4>
<img src="3_pic_12.png" class="reportImg"/>

<h3><a name="h-2-2">2.2,</a> XHTML5</h3>
HTML5 canvas was used for game animation. But in HTML aspect, the only code is:
<pre class="code">
	&lt;div id="inner" class="inner"&gt;
	&lt;/div&gt;
</pre>
The Html5 canvas was not here, it was in the Javascript file (will be explained in Javascript section). 
The purpose of the design was to make the game easily to be shared. 
By this solution, users can embed this game into other web pages by copying this "inner" HTML tag and the game.js. 
<h3><a name="h-2-3">2.3,</a> Javascript</h3>

<h4><a name="h-2-3-a">2.3.1</a> Mechanism</h4>
The mechanism of this html5 game was "canvas drawing" + "looping". Regarding the looping principle, it will be introduced in detail in later sections.<br />
Regarding the canvas drawing, five canvases were created for drawing different characters, such as the jet, enemies, the background, bullets, explosions and the game score.
They were all transparent and overlaping with each others.<br /><br />
This is the code of canvas drawing:
<pre class="code">
anJetCtx.drawImage(bgImage,this.srcX,this.srcY,this.imageWidth,this.imageheight,this.targetX,this.targetY,this.objWidth,this.objHeight);
</pre>
This function was used to draw a segment of a image into a canvas. The segment was specificed by srcX and srcY.
So, all animataion characters can be put into a single image. 
There were several Javascript classes designed for each characters and signed with different srcX and srcY.
This design matched the Object-Oriented programming (more about Object-Oriented programming will be introduced in later section).


<h4><a name="h-2-3-b">2.3.2</a> Touch screen for tablet</h4>
To support touch screen devices, HTML and Javascript were both modified:<br />
Adding the "viewport" into meta (viewport was introducted in earler chapter) and adding touching event listeners (events will be explained in the event section below). 
All that solutions were learnt from an online <a href="http://www.onlywebpro.com/2012/01/28/game-development-mouse-and-touch-event-detection/">post</a>.



<h4><a name="h-2-3-c">2.3.3</a> Social network sharing</h4>
<img src="4_game_2.png" class="reportImg"/>
To make this project more popular, social network connectivity was added into this project.
However, it did not work in the SAFE. But it was working well in local environment and Google Cloud (http://1.boocheeq.appspot.com/game.html).
<img src="4_game_3.png" class="reportImg"/>
All relative information were learnt from :<br/>
http://www.practicalecommerce.com/articles/3817-Top-10-Social-Sharing-Buttons-for-Your-Website<br/>
http://www.sharethis.com/<br/>


<h4><a name="h-2-3-d">2.3.4</a> Javascript Trick</h4>
<h4><a name="h-2-3-d-1">2.3.4.1</a> Event</h4>
This project adopted adaptable event solution:
<pre class="code">
if (addEventListener) addEventListener("load",allMyCode,false);
else attachEvent("onload", allMyCode);
// window.addEventListener("load",loadFn,false);
</pre>
<h4><a name="h-2-3-d-2">2.3.4.2</a> Single Javascript Function</h4>
All codes were located in "allMyCode" function, the advatage was if variables or functions' name were conflict with other Javascripts "moudles".
However, that would disable the ability of checking variables in Google chrome. 

<h4><a name="h-2-3-d-3">2.3.4.3</a> Innerhtml</h4>
As this report mentioned above, to make this game easliy to be shared, all htmls were located in Javascript section.
Innterhtml was used to add HTML tags into main HTML file. However, it was not safe solution. Therefore "<a href="// http://www.optimalworks.net/resources/betterinnerhtml/">BetterInnerHTML</a>" was adopted.
<pre class="code">
BetterInnerHTML(document.getElementById("inner"), 
	'&lt;canvas id="canvasBg" class="canvasBg" width="800" height="500"&gt;&lt;/canvas&gt;'+ 
	'&lt;canvas id="canvasJet" class="canvasJet" width="800" height="500"&gt;&lt;/canvas&gt;' +
	'&lt;canvas id="canvasEnemy" class="canvasEnemy" width="800" height="500"&gt;&lt;/canvas&gt;' + 
	'&lt;canvas id="canvasText" class="canvasText" width="800" height="500"&gt;&lt;/canvas&gt;' + 
	'&lt;canvas id="canvasBullet" class="canvasBullet" width="800" height="500"&gt;&lt;/canvas&gt;'
);	
</pre>

<h4><a name="h-2-3-e">2.3.5</a> Object-Oriented programming</h4>
By default, Javascript is not a Object-Oriented language, but it can be implimented by somehow. There are several different ways to achive that. 
To practice Javascript Object-Oriented programming (OOP), this project used two ways to do OOP in Javascript. 
<pre class="code">
//---------prototype based
    
function Enemy() {
	this.gameWidth = canvasBg.width;
	this.gameHeight = canvasBg.height;
}
Enemy.prototype.draw = function(){
}	

function createANewBullet(){
	var item;
	if(Object){
		item = Object.create(Bullet);
	}else{
		item = new Bullet();
	}
	item.init();
	return item;
}
</pre>
And
<pre class="code">
var Explosion ={
	srcX : 0,
	srcY : 0,
	
	init : explosionInit,
	draw : explosionDraw
};
function explosionInit(){
}
</pre>
Both solutions were adobted in this project. but the second soution was highly recommended. <br/><br/>
The differents of these two solutions are:  the function Enemy() in the first solution is a constructor, developers can do computing here.
all codes in this function will not be invoked untill an object of this class is created. 
In the second solution, there is no constructor for the class, the first paragraph was a class definition, all code here will be excuted 
when the Javascript file was loaded. Therefore,logic code shouldn't be put here. An init() function can be created for doing initialized computing.<br/><br/>

To an instance of those classes,"Object" was used to do this. However, the "Ojbect" is a new feature. So, to be compatible with elder browsers,
 the solution of this project was: 
<pre class="code">
function createANewBullet(){
    var item;
    if(Object){
        item = Object.create(Bullet);
    }else{
        item = new Bullet();
    }
    item.init();
    return item;
}
</pre>



<h4><a name="h-2-3-f">2.3.6</a> Game level</h4>
The game level system relied on game score system. Meanwhile it will affect the difficulty.
<pre class="code">
function updateGameLevel(){
	gameLavel = jet1.score/100;
	if(gameLavel > 0){
		spawnAmount = gameLavel; 
	}	
}	
</pre>
The gamelevel will be increased once the game score increases 100.<br />
Gamelevel raising will cause this game spawn more enemies. Meanwhile, Enemies' moving path will be more complex -- zpath.
<pre class="code">
if(gameLavel > 3){
	if(this.ifZpathX){
		this.score = this.score_zpath;
		this.zPathX();
	}
}
</pre>

<h4><a name="h-2-3-g">2.3.7</a> Jet Zpath Moving</h4>
Zpath moving was used to make enemies moving zigzag.
The game will radomly spawning enemies from the right side of the game. the spawning position was random. 
The zpath moving range also random. (for more detail please see the comments below)

<pre class="code">
Enemy.prototype.zPathX = function(){
	if(!this.zStepY){
		this.zStepY = zStepY;
		if(returnNChance(50)){ // randomly generate the init direction
			this.zStepY = 0 - this.zStepY;
		}
	}
	
	if(!this.zstepYRangeA){//generate a radom moving range.  (y-y/2 -- y + y/2)
		if(this.targetY &lt; this.objHeight *3){//to avoid shaking. if the plane locates at the top of screen, then make it zmoving from top to botton.
			this.zstepYRangeA = this.flyingYRangeA;
			this.zstepYRangeZ = this.flyingYRangeZ;
		}else{
			this.zstepYRangeA = this.targetY - Math.floor(this.targetY/2);
			this.zstepYRangeZ = this.targetY + Math.floor(this.targetY/2);
			if(this.zstepYRangeA &lt; 0){
				this.zstepYRangeA = 0;
			}
			if(this.zstepYRangeZ &gt; this.flyingYRangeZ){
				this.zstepYRangeZ = this.flyingYRangeZ;
			}
		}
	}
	
	this.targetY = this.targetY - this.zStepY;
	
	if(this.targetY &lt; this.zstepYRangeA || this.targetY &gt;this.zstepYRangeZ ){//change direction.
		this.zStepY = 0 - this.zStepY;
	}
	
};	
</pre>
<h4><a name="h-2-3-h">2.3.8</a> Moving background</h4>
This game offered a constantly moving background by looping the background picture.
Two copies were moving simultaneously one after another. 
<pre class="code">
function drawDynamicBg(){
    bgDrawX1 -= 5;
    bgDrawX2 -= 5;
    if (bgDrawX1 &lt;= -bgWidth) {
        bgDrawX1 = bgWidth;
    } else if (bgDrawX2 &lt;= -bgWidth) {
        bgDrawX2 = bgWidth;
    }
	realDrawGameBg(bgImage);
}
function realDrawGameBg(bgImagex){
	var bgImage = bgImagex;
	var srcX = 0;
	var srcY = 0;
	var targetX = 0;
	var targetY = 0;
	
	var gameWidth = canvasBg.width;
	var gameHeight = canvasBg.height;
	var imageWidth = bgWidth;
	var imageheight = 500;
	
    canBgCtx.clearRect(0, 0, gameWidth, gameHeight);
	
	canBgCtx.drawImage(bgImage,srcX,srcY,imageWidth,imageheight,bgDrawX1,targetY,imageWidth,gameHeight);		
	canBgCtx.drawImage(bgImage,srcX,srcY,imageWidth,imageheight,bgDrawX2,targetY,imageWidth,gameHeight);
}
</pre>

<h4><a name="h-2-3-i">2.3.9</a> Looping</h4>
There were two looping solutions: <br />
Animationframe:
<pre class="code">
var requestAnimFrame =  window.requestAnimationFrame ||
                        window.webkitRequestAnimationFrame || // for webkit
                        window.mozRequestAnimationFrame || // for firefox
                        window.msRequestAnimationFrame ||  // for ie
                        window.oRequestAnimationFrame;	 // for opera
function loop() {
    requestAnimFrame(loop);
}
</pre>
Interval:
<pre class="code">
function startShooting(){
	cleanBulletInterval();
	bulletInterval = setInterval(function(){shootxxx()},bulletFps);
}

function cleanBulletInterval(){
	clearInterval(bulletInterval);
}
</pre>

<h4><a name="h-2-3-j">2.3.10</a> Sprite</h4>
All pictures were integrated into one sprite picture. The main purpose of this mergining was less the network transactions to lower
the network loading failed risk. Meanwhile, all Javascript were waiting for assets loading. 
It was hard to monitor all pictures loading progress. One picture was much easier to handle.


<h4><a name="h-2-3-k">2.3.11</a> Mouse event handling</h4>
There were several mouse event handlers for canvas in this project. the aim of those handlers were:
"click to start game", "drag for moving jet", "touch for moving jet" and "key down for moving jet".
<pre class="code">
touchCanvas.addEventListener("mousedown",mouseDown, false);
touchCanvas.addEventListener("mousemove",mouseXY, false);
touchCanvas.addEventListener("touchstart", touchDown, false);
touchCanvas.addEventListener("touchmove", touchXY, true);
touchCanvas.addEventListener("touchend", touchUp, false);    
function mouseXY(e) {
    e.preventDefault();
    touchX = e.pageX - touchCanvas.offsetLeft;
    touchY = e.pageY - touchCanvas.offsetTop;
    processPos();
}
     
function processPos() {
     if(touchIsDown ){
        if(!touchLockingJet){
            var left = jet1.targetX;
            var right = jet1.imageWidth + jet1.targetX;
            var top = jet1.targetY;
            var bottom = jet1.imageheight + jet1.targetY;
            if(left &lt;= touchX &amp;&amp; touchX &lt;= right &amp;&amp; top &lt;= touchY &amp;&amp; touchY &lt;= bottom){
                console.log("touchLockingJet");
                touchLockingJet = 1;
                jet1TouchedX = touchX - left;
                jet1TouchedY = touchY - top;
            }
        }
     }else{
        touchLockingJet = 0;
     }
}
</pre>
e.preventDefault(); was used for blocking the default event handler. For example, "touchmove" would only able to move the jet on the canvas, but no to scroll the web page.<br/>
processPos function was used to adjust jet location according to touchX and touchY.



<h4><a name="h-2-3-l">2.3.12</a> Memory Management</h4>
As a shotting game, enemies and bullets were infinite. The memory issue was a big challenge for this project.
This project adopted two memory management solutions:<br />
<h5>Object dispose (remove enemies from enemies list):</h5>
<pre class="code">
function disposeEnimy (enimy){
	enemies.splice(enemies.indexOf(enimy),1);
	totalEnemies--;
}	
</pre>
<h5>Object recycling </h5>
<pre class="code">
if(bullet.targetY > bullet.gameWidth){
	bullet.recycle();
}
function bulletRecycle(){
	this.targetY = -20;
}	
</pre>
If bullets moved out of the game boundary, they will be recycled. 
The recycled bullet will be moved to a waiting area. When a new bullet was fired, a bullet from waiting area will be reused. 

<h4><a name="h-2-3-m">2.3.13</a> Auto scale</h4>
This game was designed for auto scale to fit different screen sizes.
<pre class="code">
.canvasBg{
    height: 80%;
    width: 80%; 
    display:block;
    background:#CCCCCC;
    margin: 10px auto 0px; /*for margin*/
    
    min-width: 400px;
    min-height: 250px;
}

.inner{
    max-width: auto; /*with maxWidth and maxHeight,*/
    max-height: auto;
    /*background: red;*/
}    
.canvasJet,.canvasEnemy,.canvasBullet,.canvasText{
    height: 80%;
    width: 80%;
    display:block;
    margin: -500px auto 0px; /*for margin*/
}
    
</pre>
Height=80% and width=80% of ".canvasJet" were designed to make the game auto fit browser's size. The background canvas worked well.
However, It was not able to control the margin of canvasJet, to make the jet to display just over this background canvas.
So the auto scale functionality was failed. Currently, the margin is hard coded. it will be fixed in further projects.<br />

The width and height were hard coded in the HTML. It should be in the CSS sheet, but it did not work as expect.
<pre class="code">
&lt;canvas id="canvasBullet" class="canvasBullet" width="800" height="500"&gt;&lt;/canvas&gt;
</pre>

<h2><a name="h-3">3,</a>Development Environment</h2>
This project offers mobile ability. To test this project in mobile devices, this project was uploaded into the cloud. 
Codenvy is a cloud based IDE which supports HTML and Javascript development.
Meanwhile, Codenvy supports web based IDE. Developers can developing by browsers anytime anywhere.
GitHub can synchronize the source code between local developement enviroment and online IDE.
<img src="3_pic_13.png" class="reportImg"/>

<h2><a name="h-4">4,</a>Testing</h2>
This project was tested by IE6, Firefox, Safari, Chrome and Opera. Because there are several new CSS features such as coner radius. They are 
not supported by IE6 but the layout and content can work as normal. <br /><br />
Regarding the Html5 canvas, old browsers do not supprt it, such IE6. a notification will display on the web page if Html5 canvas is not supprted.
There are several solutions for checking HTHML5 canvas supporting:
<pre class="code">
&lt;canvas&gt;  
Your browser does not support the HTML5 canvas tag.
&lt;/canvas&gt;  
</pre>
Above solution is the easiest way to check HTML5 canvas ability. Nevertheless, this project adopted a challenging method -- checking by Javascript:
<pre class="code">
var canvasEl = document.createElement('canvas'); //create the canvas object
if(!canvasEl.getContext) //if the method is not supported, i.e canvas is not supported
{ 
  document.write("HTML5 Canvas Not Supported By Your Browser");
  return;
}
</pre>
Or
<pre class="code">
if (Modernizr.canvas) {
  // let's draw some shapes!
} else {
  // no native canvas support available :(
}    
</pre>
 
However, above solutions were failed the testing in IE6. The Javascript were collapsed. Alternatively, the solution of this project was adding a Label tag
to notice users the current brower does not support Html5 canvas, if it supports Html5 canvas, the Label tag will be removed.
<pre class="code">
&lt;label id="html5checker_my"&gt; Dear user, your browser does not support html5, please use Chrome for this game. Thanks!&lt;/label&gt;
function html5checking(){
    var test_canvas = document.createElement("canvas"); //try and create sample canvas element
    var canvascheck=(test_canvas.getContext)? true : false; //check if object supports getContext() method, a method of the canvas element
    if(canvascheck){
        document.getElementById('html5checker_my').style.display='none';
    }else{
        alert("Dear user, your browser does not support html5, please use Chrome for this game. Thanks!");
    }
}         
</pre>
One thing was worth noting, this code segement used Javascript control CSS style.<br/>
Testing on IE6 for XHTML section: (Lost "border-radius" style, because it is a new CSS3 feature. But the web page can display without problems.)
<img src="5_test_ie_1.png" class="reportImg"/>
Testing on IE6 for the game section: (IE6 does not support HTML5 canvas. The application showed proper notification)
<img src="5_test_ie_2.png" class="reportImg"/>
IE 8 for the XHTML section
<img src="5_test_ie_3.png" class="reportImg"/>
IE 9 for the XHTML section
<img src="5_test_ie_4.png" class="reportImg"/>
IE 9 for the game section.
<img src="5_test_ie_6.png" class="reportImg"/>
Testing on Opera, Chrome, Firefox, Safari.
<img src="5_test_1.png" class="reportImg"/>
Mobile devices.
<img src="5_test_2.png" class="reportImg"/>
Opera has issue with Html5 canvas, so it failed on game testing.

<h2><a name="h-5">5,</a>SAFE error handling</h2>
<img src="6_safe_1.png" class="reportImg"/>
As above snapshots show, SAFE does not support "=" in URL. A url <a href="http://www.shorturl.com/">redirect service</a> was adopted in this projct to make a short url without illegal characters.
<pre class="code">
&lt;input required/&gt;    
</pre>
The attribute "required" was illegal in SAFE, so all "required" validations was discarded.


<h2><a name="h-6">6,</a>Google Cloud</h2>
This project was also synchronized onto Google Cloud which can be accessed by : http://boocheeq.appspot.com/
<img src="7_cloud_1.png" class="reportImg"/>
        			</content>
        		</article>
        	</div>
        </div>
        
	    <footer class="mainFooter">
	    	<p>
		    	Acknowledge: 
		    	http://www.optimalworks.net/
	    	</p>
	    </footer>
    </body>
</html>
